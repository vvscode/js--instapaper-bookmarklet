function highlightRegex(e){return new RegExp(e.replace(/[.*+?|()\[\]{}\\$^]/g,"\\$&"),"ig")}function doHighlight(e,t,n,r,i,s){var o=document;typeof e=="string"&&(e=o.getElementById(e)),typeof r=="string"&&(r=highlightRegex(r)),i=i||0,s=s||0;var u=[],a=[],f=0,l=e.childNodes.length,c,h=0,p=[],d,v,m;for(;;){while(f<l){d=e.childNodes[f++];if(d.nodeType===3)u.push({i:h,n:d}),c=d.nodeValue,a.push(c),h+=c.length;else if(d.nodeType===1){if(d.tagName.search(/^(script|style)$/i)>=0)continue;d.tagName.search(/^(a|b|basefont|bdo|big|em|font|i|s|small|span|strike|strong|su[bp]|tt|u)$/i)<0&&(a.push(" "),h++),v=d.childNodes.length,v&&(p.push({n:e,l:l,i:f}),e=d,l=v,f=0)}}if(!p.length)break;m=p.pop(),e=m.n,l=m.l,f=m.i}if(!u.length)return;a=a.join(""),u.push({i:a.length});var g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D;y=null;for(var E=0;E<=s;E++){y=r.exec(a);if(!y||y.length<=i||!y[i].length)break}if(!y)return;b=y.index;for(g=1;g<i;g++)b+=y[g].length;w=b+y[i].length,S=0,x=u.length;while(S<x)E=S+x>>1,b<u[E].i?x=E:b>=u[E+1].i?S=E+1:S=x=E;T=S;while(T<u.length){N=u[T],e=N.n,c=e.nodeValue,C=e.parentNode,k=e.nextSibling,A=b-N.i,O=Math.min(w,u[T+1].i)-N.i,M=null,A>0&&(M=c.substring(0,A)),_=c.substring(A,O),D=null,O<c.length&&(D=c.substr(O)),M?e.nodeValue=M:C.removeChild(e),L=o.createElement("span"),L.appendChild(o.createTextNode(_)),L.className=t,L.setAttribute("rel",n),L.setAttribute("fragmention",""),C.insertBefore(L,k),D&&(L=o.createTextNode(D),C.insertBefore(L,k),u[T]={n:L,i:w}),T++;if(w<=u[T].i)return}}function quickHighlight(e,t,n){t=t.trim(),search_for=new RegExp(t.replace(/[.*+?|()\[\]{}\\$^]/g,"\\$&").replace(/\s+/g,"\\s+"),"ig"),doHighlight(document.body,"instapaper_highlight",e,search_for,0,n),highlight_spans=document.getElementsByClassName("instapaper_highlight"),highlight_spans.length&&window.scrollTo(0,highlight_spans[0].offsetTop-100)}document.addEventListener("DOMContentLoaded",function(){var e=location.href.match(/#(#|%23)(.+)/)||[0,0,""],t=document.getElementById(e[1]+e[2]),n=decodeURIComponent(e[2]).replace(/\+/g," ").split("  "),r=parseFloat(n[n.length-1]);location.fragmention=isNaN(r)?n.join("  "):n.slice(0,-1).join("  "),location.fragmentionIndex=r||0,!t&&location.fragmention&&location.fragmention.length&&quickHighlight(0,location.fragmention,location.fragmentionIndex)});